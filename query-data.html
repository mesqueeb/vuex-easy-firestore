<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Read data | Vuex Easy Firestore ðŸ”¥</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="Easy coupling of firestore and vuex. 2-way sync with 0 boilerplate!">
    <link rel="preload" href="/vuex-easy-firestore/assets/css/0.styles.7e771a3c.css" as="style"><link rel="preload" href="/vuex-easy-firestore/assets/js/app.7865803c.js" as="script"><link rel="preload" href="/vuex-easy-firestore/assets/js/2.a44a5bbe.js" as="script"><link rel="preload" href="/vuex-easy-firestore/assets/js/13.65b1116f.js" as="script"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/10.afce603d.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/11.121d4951.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/12.1a70acda.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/14.f676c9f6.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/15.61ced602.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/3.a50046c5.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/4.e6717748.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/5.b8d3685e.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/6.89669ab9.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/7.5de5c22a.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/8.14128c0a.js"><link rel="prefetch" href="/vuex-easy-firestore/assets/js/9.083d4adf.js">
    <link rel="stylesheet" href="/vuex-easy-firestore/assets/css/0.styles.7e771a3c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuex-easy-firestore/" class="home-link router-link-active"><!----> <span class="site-name">Vuex Easy Firestore ðŸ”¥</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/mesqueeb/vuex-easy-firestore/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/mesqueeb/vuex-easy-firestore" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/mesqueeb/vuex-easy-firestore/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/mesqueeb/vuex-easy-firestore" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/vuex-easy-firestore/setup.html" class="sidebar-link">Installation &amp; setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/setup.html#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/setup.html#setup" class="sidebar-link">Setup</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/setup.html#in-a-nutshell" class="sidebar-link">In a nutshell</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/setup.html#first-steps" class="sidebar-link">First steps</a></li></ul></li><li><a href="/vuex-easy-firestore/add-and-manage-data.html" class="sidebar-link">Add and manage data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/add-and-manage-data.html#basic-usage" class="sidebar-link">Basic usage</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/add-and-manage-data.html#collection-mode" class="sidebar-link">'collection' mode</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/add-and-manage-data.html#doc-mode" class="sidebar-link">'doc' mode</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/add-and-manage-data.html#batch-updates-inserts-deletions" class="sidebar-link">Batch updates/inserts/deletions</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/add-and-manage-data.html#duplicating-docs" class="sidebar-link">Duplicating docs</a></li></ul></li><li><a href="/vuex-easy-firestore/query-data.html" class="active sidebar-link">Read data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#realtime-updates-vs-single-fetch" class="sidebar-link">Realtime updates vs single fetch</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#realtime-updates-opendbchannel" class="sidebar-link">Realtime updates: openDBChannel</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#fetching-docs" class="sidebar-link">Fetching docs</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#firestore-authentication" class="sidebar-link">Firestore authentication</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#where-orderby-clauses" class="sidebar-link">where / orderBy clauses</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#automatic-initial-doc-insertion" class="sidebar-link">Automatic initial doc insertion</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#multiple-modules-with-2-way-sync" class="sidebar-link">Multiple modules with 2-way sync</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#sync-directly-to-module-state" class="sidebar-link">Sync directly to module state</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/query-data.html#manual-fetch-handling" class="sidebar-link">Manual fetch handling</a></li></ul></li><li><a href="/vuex-easy-firestore/firestore-fields-and-functions.html" class="sidebar-link">Firestore fields and functions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/firestore-fields-and-functions.html#arrayunion-and-arrayremove" class="sidebar-link">arrayUnion and arrayRemove</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/firestore-fields-and-functions.html#increment" class="sidebar-link">increment</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/firestore-fields-and-functions.html#delete-fields" class="sidebar-link">Delete fields</a></li></ul></li><li><a href="/vuex-easy-firestore/hooks.html" class="sidebar-link">Hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/hooks.html#hooks-on-local-changes" class="sidebar-link">Hooks on local changes</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/hooks.html#hooks-after-local-changes-before-sync" class="sidebar-link">Hooks after local changes before sync</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/hooks.html#hooks-after-server-changes" class="sidebar-link">Hooks after server changes</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/hooks.html#hooks-on-opendbchannel-fetch" class="sidebar-link">Hooks on openDBChannel / fetch</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/hooks.html#execution-timings-of-hooks" class="sidebar-link">Execution timings of hooks</a></li></ul></li><li><a href="/vuex-easy-firestore/extra-features.html" class="sidebar-link">Extra features</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/extra-features.html#variables-for-firestorepath-or-clauses" class="sidebar-link">Variables for firestorePath or clauses</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/extra-features.html#fillables-and-guard" class="sidebar-link">Fillables and guard</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/extra-features.html#default-values" class="sidebar-link">Default values</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/extra-features.html#firestore-timestamp-conversion" class="sidebar-link">Firestore Timestamp conversion</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/extra-features.html#pass-firebase-dependency" class="sidebar-link">Pass Firebase dependency</a></li><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/extra-features.html#custom-sync-debounce-duration" class="sidebar-link">Custom sync debounce duration</a></li></ul></li><li><a href="/vuex-easy-firestore/faq.html" class="sidebar-link">FAQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuex-easy-firestore/faq.html#firebase-error-app-duplicate-service" class="sidebar-link">Firebase Error app/duplicate-service</a></li></ul></li><li><a href="/vuex-easy-firestore/config-example.html" class="sidebar-link">Config example</a></li><li><a href="/vuex-easy-firestore/feedback.html" class="sidebar-link">Feedback</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="read-data"><a href="#read-data" class="header-anchor">#</a> Read data</h1> <p>The prime philosophy of Vuex Easy Firestore is to be able to have a vuex module (or several) which are all in sync with Firestore. When your app is openend there are two ways you can get data from Firestore and have it added to your vuex modules:</p> <ul><li>get realtime updates</li> <li>fetch the document(s) once</li></ul> <p>To have a better understanding of the difference I will give some examples:</p> <h2 id="realtime-updates-vs-single-fetch"><a href="#realtime-updates-vs-single-fetch" class="header-anchor">#</a> Realtime updates vs single fetch</h2> <p>Realtime updates are powered by Firestore's <a href="https://firebase.google.com/docs/firestore/query-data/listen" target="_blank" rel="noopener noreferrer">onSnapshot<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> listener. This means that if data on the server is changed, the changes are pushed to all clients that have your application open.</p> <p>With Vuex easy firestore using <em>realtime updates</em> will effectively make <strong>a 2-way sync between your firestore collection or doc and your vuex module</strong>.</p> <p>Fetching the document(s) once is when you want to retrieve the document(s) once, when your application or a page is opened, but do not require to have the data to be live updated when the server data changes.</p> <p>Both with <em>realtime updates</em> and with <em>fetching docs</em> you can use <code>where</code> clauses to specify which docs you want to retrieve (just like Firestore). In some modules you might initially open a channel for <em>realtime updates</em> with a certain <code>where</code> clause, and later when the user requests other docs do an additional <code>fetch</code> with another <code>where</code> clause.</p> <h2 id="realtime-updates-opendbchannel"><a href="#realtime-updates-opendbchannel" class="header-anchor">#</a> Realtime updates: openDBChannel</h2> <p>If you want to get <em>realtime updates</em>, you need to dispatch the <code>openDBChannel</code> action. Eg.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'moduleName/openDBChannel'</span><span class="token punctuation">)</span>
</code></pre></div><p><code>openDBChannel</code> relies on the Firestore <a href="https://firebase.google.com/docs/firestore/query-data/listen" target="_blank" rel="noopener noreferrer">onSnapshot<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> function to get notified of remote changes. The doc(s) are automatically added to/updated in your Vuex module under <code>moduleName/statePropName</code>.</p> <p>Mind that:</p> <ul><li>if the channel is opened on a document which does not exist yet at Firebase, the document gets automatically (re)created, unless you set <code>preventInitialDocInsertion</code> to <code>true</code></li> <li>the action returns a promise which resolves when the state of the module has been populated with data (served either from cache or server), so you know you can start working with it</li> <li>when this promise is resolved, you get another one which lets you know when an error occurs</li></ul> <p>Just like the Firebase SDK, you can also use a <a href="#where-orderby-clauses"><code>where</code> clause</a>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'moduleName/openDBChannel'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> streaming <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// the state has been populated with data, you may start working with it</span>
    <span class="token function">startDoingThings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// you must check that the channel keeps streaming and catch errors. Mind that</span>
    <span class="token comment">// even while offline, the channel is considered as &quot;streaming&quot; and will remain</span>
    <span class="token comment">// so until you close it or until an error occurs.</span>
    streaming
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// this gets resolved when you close the channel yourself</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// an error occured and the channel has been closed, you should figure</span>
        <span class="token comment">// out what happened and open a new channel.</span>
        <span class="token comment">// Perhaps the user lost his `read` rights on the resource, or maybe the</span>
        <span class="token comment">// document got deleted and it wasn't possible to recreate it (possibly</span>
        <span class="token comment">// because `preventInitialDocInsertion` is `false`). Or some other error</span>
        <span class="token comment">// from Firestore.</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Same as the other `catch` block above</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Sometimes the promise returned by the action might not be enough for you, because you need to know when the module has been populated with fresh data, not cached data. In that case, you need to pass an option when calling the action, which in turn will provide you with an additional promise. This, however, will also trigger your server hook listeners more frequently. Read <a href="https://firebase.google.com/docs/firestore/query-data/listen#events-metadata-changes" target="_blank" rel="noopener noreferrer">Firestore's documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to know more about this.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'moduleName/openDBChannel'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>includeMetadataChanges<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>refreshed<span class="token punctuation">,</span> streaming<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    refreshed
     <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token comment">// the state has been populated with fresh data</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    streaming
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Finally, if you open multiple channels on a same module with different clauses, you will need to use the <code>stop</code> method provided in the promise to handle their closing at your discretion:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'moduleName/openDBChannel'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>streaming<span class="token punctuation">,</span> stop<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// the channel has been closed</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="close-db-channel"><a href="#close-db-channel" class="header-anchor">#</a> Close DB channel</h3> <p>In some cases you need to close the connection to Firestore (unsubscribe from Firestore's <code>onSnapshot</code> listener). Eg. when your user signs out. In this case, make sure you call <code>closeDBChannel</code> like so:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'moduleName/closeDBChannel'</span><span class="token punctuation">)</span>
</code></pre></div><p>This will close the connection using Firestore's <a href="https://firebase.google.com/docs/firestore/query-data/listen#detach_a_listener" target="_blank" rel="noopener noreferrer">unsubscribe function<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Please note that <code>closeDBChannel</code> does not mean it will not listen for &quot;local&quot; changes! This means that even with a closedDBChannel, you can continue to insert/patch/delete docs and they will still be synced to the server. However, changes on the server side will not be reflected to the app anymore.</p> <p><code>closeDBChannel</code> will not clear out the data in your current vuex module. You can also close the connection and completely clear out the module; removing all docs from your vuex module. (without deleting anything on the server, don't worry) In this case do:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'moduleName/closeDBChannel'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> clearModule<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="fetching-docs"><a href="#fetching-docs" class="header-anchor">#</a> Fetching docs</h2> <p>If you want to fetch docs once (opposed to <em>realtime updates</em>) you can use the <code>fetchAndAdd</code> (or <code>fetchById</code>) action.</p> <p>These actions are a wrapper around the Firestore <code>db.collection(path).get()</code> and <code>db.doc(path).get()</code> functions.
(See 'Read data' in the <a href="https://firebase.google.com/docs/firestore/query-data/get-data" target="_blank" rel="noopener noreferrer">Firestore documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <h3 id="fetching-in-doc-mode"><a href="#fetching-in-doc-mode" class="header-anchor">#</a> Fetching in 'doc' mode</h3> <p>In 'doc' mode your <code>firestorePath</code> is the path to a single document. Therefor just calling <code>fetchAndAdd</code> will (1) retrieve the doc from Firestore and (2) add it to your Vuex module.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myDocModule/fetchAndAdd'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fetching-in-collection-mode"><a href="#fetching-in-collection-mode" class="header-anchor">#</a> Fetching in 'collection' mode</h3> <p>In 'collection' mode you can use these actions to fetch docs:</p> <ul><li><code>fetchById</code> retrieves a single doc and adds it to your module</li> <li><code>fetchAndAdd</code> retrieves multiple docs and adds them to your module</li></ul> <p>Both these actions will (1) retrieve the doc(s) from Firestore and (2) add it to your Vuex module.</p> <p>Let's see an example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pokemonModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  firestorePath<span class="token operator">:</span> <span class="token string">'pokemon'</span><span class="token punctuation">,</span>
  firestoreRefType<span class="token operator">:</span> <span class="token string">'collection'</span><span class="token punctuation">,</span>
  moduleName<span class="token operator">:</span> <span class="token string">'pokemon'</span><span class="token punctuation">,</span>
  statePropName<span class="token operator">:</span> <span class="token string">'data'</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You could retrieve a single PokÃ©mon by ID like so:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'pokemon/fetchById'</span><span class="token punctuation">,</span> <span class="token string">'001'</span><span class="token punctuation">)</span>
</code></pre></div><p>Or you could retrieve all PokÃ©mon like so:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'pokemon/fetchAndAdd'</span><span class="token punctuation">)</span>
</code></pre></div><p>Of course, just like the Firebase SDK, you can also use a <code>where</code> clause to retrieve eg. all water PokÃ©mon. (Read more on <a href="#where-orderby-clauses">where clauses</a> down below)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'pokemon/fetchAndAdd'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token string">'water'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="a-note-on-fetch-limit"><a href="#a-note-on-fetch-limit" class="header-anchor">#</a> a note on fetch limit</h3> <p>When doing <code>fetchAndAdd</code> there will be a limit that defaults to 50 docs. If you want to fetch <em>the next 50 docs</em> you just need to call the <code>fetchAndAdd</code> action again, and it will automatically retrieve the next docs! See the example below:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// call once to fetch the first 50:</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetchAndAdd'</span><span class="token punctuation">)</span>
<span class="token comment">// then just call again to fetch the next 50!</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetchAndAdd'</span><span class="token punctuation">)</span>
<span class="token comment">// and so on...</span>
</code></pre></div><p>You can pass a custom fetch limit or disable the fetch limit by passing 0:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// custom fetch limit:</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetchAndAdd'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> clauses<span class="token operator">:</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// no fetch limit:</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetchAndAdd'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> clauses<span class="token operator">:</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The <code>fetchAndAdd</code> action will return a promise resolving in <code>{done: true}</code> if there are no more docs to be fetched. You can use this to check when to stop fetching like so:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">fetchAndAdd</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> fetchResult <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetchAndAdd'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fetchResult<span class="token punctuation">.</span>done <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'all done!'</span>
  <span class="token keyword">return</span> <span class="token string">'retrieved 50 docs, call again to fetch the next!'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you require to know <strong>wether or not fetch was called at least once</strong>, you can do so by looking at the the state prop called <code>state._sync.fetched</code> of your module. If this is an empty object, fetch was not yet triggered. If it has data inside you know fetch has been called at least once.</p> <h2 id="firestore-authentication"><a href="#firestore-authentication" class="header-anchor">#</a> Firestore authentication</h2> <p>In most cases your application will have many users, and your Firestore path will need to include the user ID of the user who is signed in. This can be done in Vuex Easy Firestore by using the <code>{userId}</code> wildcard like so:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  firestorePath<span class="token operator">:</span> <span class="token string">'userDocs/{userId}/data'</span><span class="token punctuation">,</span>
  firestoreRefType<span class="token operator">:</span> <span class="token string">'collection'</span><span class="token punctuation">,</span>
  moduleName<span class="token operator">:</span> <span class="token string">'userData'</span><span class="token punctuation">,</span>
  statePropName<span class="token operator">:</span> <span class="token string">'data'</span><span class="token punctuation">,</span>
  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// automatically added</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Of course, you will need to wait for the user to sign in and only then dispatch either <code>openDBChannel</code> or <code>fetchAndAdd</code>. For this you can use Firebase's native <code>onAuthStateChanged</code> function:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Be sure to initialise Firebase first!</span>
Firebase<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onAuthStateChanged</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// user is logged in so openDBChannel</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'userData/openDBChannel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
    <span class="token comment">// or fetchAndAdd</span>
    <span class="token comment">// store.dispatch('userData/fetchAndAdd')</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>If you want to use the library without fetching documents, so without using <code>openDBChannel</code> and <code>fetchAndAdd</code>, you will notice that <code>{userId}</code> is not automatically replaced with the user id. This is because <code>openDBChannel</code> and <code>fetchAndAdd</code> both dispatch an action called <code>setUserId</code> that retrieves the current user id from Firebase authentication and places it in the firestorePath.</p> <p>In this case you can manually dispatch <code>setUserId</code> like so:</p> <div class="language-js extra-class"><pre class="language-js"><code>Firebase<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onAuthStateChanged</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// in case you do not use `openDBChannel` or `fetchAndAdd`</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'userData/setUserId'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>When required you can also manually pass a user id like so: <code>dispatch('userData/setUserId', id)</code></p> <h2 id="where-orderby-clauses"><a href="#where-orderby-clauses" class="header-anchor">#</a> where / orderBy clauses</h2> <blockquote><p>Only for 'collection' mode.</p></blockquote> <p>Just like Firestore, you can use <code>where</code> and <code>orderBy</code> to clauses which docs are retrieved and synced.</p> <ul><li><em>where:</em> arrays of &quot;parameters&quot; that get passed on to firestore's <code>.where(...parameters)</code></li> <li><em>orderBy:</em> a single &quot;array&quot; that gets passed on to firestore's <code>.orderBy(...array)</code></li></ul> <p>There are three ways to use where and orderBy. As per example we will define <code>where</code> and <code>orderBy</code> variables first, then show how you can use them:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// an array of arrays</span>
<span class="token keyword">const</span> where <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'some_field'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'another_field'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token comment">// can have several parameters</span>
<span class="token keyword">const</span> orderBy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'created_at'</span><span class="token punctuation">]</span>
</code></pre></div><ol><li>Pass together with openDBChannel:</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/openDBChannel'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> clauses<span class="token operator">:</span> <span class="token punctuation">{</span> where<span class="token punctuation">,</span> orderBy <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>Pass together with fetchAndAdd:</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetchAndAdd'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> clauses<span class="token operator">:</span> <span class="token punctuation">{</span> where<span class="token punctuation">,</span> orderBy <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>Define inside your vuex module, to set as default when for <code>openDBChannel</code>:</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  firestorePath<span class="token operator">:</span> <span class="token string">'myDocs'</span><span class="token punctuation">,</span>
  firestoreRefType<span class="token operator">:</span> <span class="token string">'collection'</span><span class="token punctuation">,</span>
  moduleName<span class="token operator">:</span> <span class="token string">'myModule'</span><span class="token punctuation">,</span>
  statePropName<span class="token operator">:</span> <span class="token string">'data'</span><span class="token punctuation">,</span>
  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// automatically added</span>
  sync<span class="token operator">:</span> <span class="token punctuation">{</span>
    where<span class="token punctuation">,</span>
    orderBy<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// Now you can do:</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/openDBChannel'</span><span class="token punctuation">)</span>
<span class="token comment">// And it will use the where and orderBy as defined in your module</span>
</code></pre></div><h3 id="a-note-on-orderby"><a href="#a-note-on-orderby" class="header-anchor">#</a> a note on orderBy</h3> <p>Using <code>orderBy</code> works just like in Firebase: &quot;the docs will be retrieved in that order&quot;.
Please note however, that your docs are saved inside an object in your Vuex module. <strong>JavaScript object properties do not have an order.</strong> (the prop-order might differ from browser to browser)</p> <p>This means that even though you can retrieve your docs in a certain order, when showing them in a Vue component, you will need to manually sort the docs in the order you want. You can do this through a getter in your Vuex module. Eg.</p> <div class="language-js extra-class"><pre class="language-js"><code>getters<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">sortedDocs</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> getters</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// your sort function</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="userid-in-where-orderby"><a href="#userid-in-where-orderby" class="header-anchor">#</a> userId in where/orderBy</h3> <p>You can also use variables like <code>userId</code> (of the authenticated user) inside where clauses. Eg.</p> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/openDBChannel'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  where<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'created_by'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token string">'{userId}'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>{userId}</code> will be automatically replaced with the authenticated user id.</p> <p>Besides <code>userId</code> you can also use &quot;custom variables&quot;. For more information on this, see the chapter on <a href="/vuex-easy-firestore/extra-features.html#variables-for-firestorepath-or-clauses">variables for firestorePath or clauses</a>.</p> <h3 id="example-usage-opendbchannel-and-fetchandadd"><a href="#example-usage-opendbchannel-and-fetchandadd" class="header-anchor">#</a> Example usage: openDBChannel and fetchAndAdd</h3> <p>Say you have an &quot;notes&quot; application that shows a user's notes when the app is opened, but only notes that are not &quot;archived&quot;. Then later when the user opens the archive-page those notes are fetched and shown as well.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// when the app is opened after user authentication:</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'userNotes/openDBChannel'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  where<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'archived'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'created_by'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token string">'{userId}'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// then when the archive-page is opened:</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'userNotes/fetchAndAdd'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  where<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'archived'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'created_by'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token string">'{userId}'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Both <code>openDBChannel</code> and <code>fetchAndAdd</code> will add the documents in the same Vuex module, so it is really easy to work with. You can then create some getters with just the archived or not-archived notes like so:</p> <div class="language-js extra-class"><pre class="language-js"><code>getters<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">notArchivedNotes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">note</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>note<span class="token punctuation">.</span>archived<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">archivedNotes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">note</span> <span class="token operator">=&gt;</span> note<span class="token punctuation">.</span>archived<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="automatic-initial-doc-insertion"><a href="#automatic-initial-doc-insertion" class="header-anchor">#</a> Automatic initial doc insertion</h2> <blockquote><p>Only for 'doc' mode</p></blockquote> <p>When your vuex-easy-firestore module has <code>firestoreRefType: 'doc'</code>, either with openDBChannel or fetchAndAdd it will try and find that single document in your Firestore, according to your <code>firestorePath</code>. However, sometimes there might be cases where this doc does not yet exist inside your Firestore. When this happens vuex-easy-firestore will automatically insert an initial doc for you.</p> <p>In the example below we have a setup where one document per page is fetched and added when a page is opened. The <code>pageId</code> is retrieved from Vue router:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Vuex module</span>
<span class="token keyword">const</span> myModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  firestorePath<span class="token operator">:</span> <span class="token string">'pages/{pageId}'</span><span class="token punctuation">,</span>
  firestoreRefType<span class="token operator">:</span> <span class="token string">'doc'</span><span class="token punctuation">,</span>
  moduleName<span class="token operator">:</span> <span class="token string">'openPage'</span><span class="token punctuation">,</span>
  statePropName<span class="token operator">:</span> <span class="token string">'data'</span><span class="token punctuation">,</span>
  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// automatically added</span>
<span class="token punctuation">}</span>

<span class="token comment">// Vue component</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'openPage'</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pageId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
    <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'openPage/fetchAndAdd'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> pageId <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>However, there might be cases where you want to prevent an initial doc to be added automatically. One example case might be when a user that visits the page doesn't have the permission to insert docs. In this case you can prevent the initial doc insert by vuex-easy-firestore entirely:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Vuex module</span>
<span class="token keyword">const</span> myModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  firestorePath<span class="token operator">:</span> <span class="token string">'pages/{pageId}'</span><span class="token punctuation">,</span>
  firestoreRefType<span class="token operator">:</span> <span class="token string">'doc'</span><span class="token punctuation">,</span>
  moduleName<span class="token operator">:</span> <span class="token string">'openPage'</span><span class="token punctuation">,</span>
  statePropName<span class="token operator">:</span> <span class="token string">'data'</span><span class="token punctuation">,</span>
  sync<span class="token operator">:</span> <span class="token punctuation">{</span>
    preventInitialDocInsertion<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Vue component</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'openPage'</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pageId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
    <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'openPage/fetchAndAdd'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> pageId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">===</span> <span class="token string">'preventInitialDocInsertion'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// an initial doc insertion was prevented</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can also disable initial doc insertion on the top level for all modules:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> easyFirestore <span class="token operator">=</span> <span class="token function">createEasyFirestore</span><span class="token punctuation">(</span><span class="token punctuation">[</span>module1<span class="token punctuation">,</span> module2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> preventInitialDocInsertion<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// include as PLUGIN in your vuex store:</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... your store</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>easyFirestore<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="multiple-modules-with-2-way-sync"><a href="#multiple-modules-with-2-way-sync" class="header-anchor">#</a> Multiple modules with 2-way sync</h2> <p>Of course you can have multiple vuex modules, all in sync with different firestore paths.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> userDataModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* config */</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> anotherModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* config */</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> aThirdModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* config */</span>
<span class="token punctuation">}</span>
<span class="token comment">// make sure you choose a different moduleName and firestorePath each time!</span>
<span class="token keyword">const</span> easyFirestores <span class="token operator">=</span> <span class="token function">createEasyFirestore</span><span class="token punctuation">(</span><span class="token punctuation">[</span>userDataModule<span class="token punctuation">,</span> anotherModule<span class="token punctuation">,</span> aThirdModule<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  logging<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// and include as PLUGIN in your vuex store:</span>
store<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... your store</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>easyFirestores<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Do not forget you will have to dispatch openDBChannel or fetchAndAdd for each module you want to retrieve the doc(s) of:</p> <div class="language-js extra-class"><pre class="language-js"><code>Firebase<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onAuthStateChanged</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'userDataModule/openDBChannel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'anotherModule/openDBChannel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'aThirdModule/openDBChannel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="sync-directly-to-module-state"><a href="#sync-directly-to-module-state" class="header-anchor">#</a> Sync directly to module state</h2> <p>In your vuex-easy-firestore modules you can -- instead of choosing <code>statePropName</code> where your docs will be added to -- choose to leave <code>statePropName</code> blank.</p> <p>Leaving <code>statePropName</code> blank and syncing directly to the state means that the doc(s) will be added directly to the <code>state</code> of the module.</p> <p>In most cases I would advise against this, because you might want to save other data in your module's state as well. Mixing your documents data with other data will give you a harder time when creating getters for that module!</p> <p>It is usually much better to use the same <code>statePropName</code> (eg. <code>'data'</code>) for all modules. This makes writing getters etc. much easier.</p> <h2 id="manual-fetch-handling"><a href="#manual-fetch-handling" class="header-anchor">#</a> Manual fetch handling</h2> <blockquote><p>Only for 'collection' mode.</p></blockquote> <p>Besides <code>fetchAndAdd</code> there is also the <code>fetch</code> action. The difference is that with just <code>fetch</code> it will not add the documents to your vuex module, so you can handle the result yourself. <code>fetch</code> is useful because it will automatically use the Firestore path from your module.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'archived'</span><span class="token punctuation">,</span> <span class="token string">'=='</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">querySnapshot</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>querySnapshot<span class="token punctuation">.</span>done <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// `{done: true}` is returned when everything is already fetched and there are 0 docs:</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished fetching all docs'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// do whatever you want with the `querySnapshot`</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
</code></pre></div><p>The <code>querySnapshot</code> that is returned is the same querySnapshot as the Firestore one. Please read the <a href="https://firebase.google.com/docs/reference/js/firebase.firestore.QuerySnapshot" target="_blank" rel="noopener noreferrer">Firestore documentation on querySnapshot<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to know what you can do with these. Only when all documents were already fetched (and the result is 0 docs) vuex-easy-firestore will return <code>{done: true}</code> instead.</p> <p>Please note, just like <a href="#fetching-docs">fetchAndAdd</a> explained above, <code>fetch</code> also has a default limit of 50 docs per retrieval. You can then continue calling fetch to retrieve the next set of docs or pass a custom limit or 0 to disable it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// custom fetch limit:</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> clauses<span class="token operator">:</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// no fetch limit:</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'myModule/fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> clauses<span class="token operator">:</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mesqueeb/vuex-easy-firestore/edit/dev/docs/query-data.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/vuex-easy-firestore/add-and-manage-data.html" class="prev">
        Add and manage data
      </a></span> <span class="next"><a href="/vuex-easy-firestore/firestore-fields-and-functions.html">
        Firestore fields and functions
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuex-easy-firestore/assets/js/app.7865803c.js" defer></script><script src="/vuex-easy-firestore/assets/js/2.a44a5bbe.js" defer></script><script src="/vuex-easy-firestore/assets/js/13.65b1116f.js" defer></script>
  </body>
</html>
